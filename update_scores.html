<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Update Scores CSV</title>
    <style>
        body {
            font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
            margin: 10px;
            background-color: #1e1e1e;
            color: #7c7a7a;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 10px;
            vertical-align: top;
            justify-content: center;
        }
        table, th, td {
            border: 1px solid black;
        }
        th, td {
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #333333;
        }
        .comparison-container {
            display: flex;
            justify-content: space-between;
        }
        .table-container {
            width: 45%;
        }
        .logo-container {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }
        .bold-text {
            font-weight: bold;
        }
        .generate-button {
            display: flex;
            justify-content: center;
            margin: 20px;
        }
        button {
            background-color: #fff;
            color: #000;
            padding: 10px 20px;
            margin-top: 10px;
            border: 1px solid #444444;
            cursor: pointer;
            height: 36px;
        }
    </style>
</head>
<body>
    <div class="logo-container">
        <img src="./logos/logo.png" alt="Euro 2024 Logo" style="width:200px;">
    </div>
    <div class="generate-button">
        <button onclick="generateScoresCSV()">Update Scores CSV</button>
    </div>

    <script>
        function loadCSV(file, callback) {
            fetch(file)
                .then(response => response.text())
                .then(data => {
                    const rows = data.split('\n').map(row => row.split(','));
                    callback(rows);
                })
                .catch(error => console.error('Error loading CSV:', error));
        }

        function generateScoresCSV() {
            loadCSV('./results_csv/Actual_Results.csv', actualResults => {
                fetch('./jsons/participants.json')
                    .then(response => response.json())
                    .then(data => {
                        const scores = calculateScores(actualResults, data.participants);
                        createScoresCSV(scores, data.participants);
                    })
                    .catch(error => console.error('Error loading participants list:', error));
            });
        }

        function calculateScores(actualResults, participants) {
            // Implement your logic to calculate scores based on actualResults and participants data
            const scores = participants.map(participant => {
                // Example calculation (you should replace it with your actual logic)
                const score = actualResults.reduce((acc, result) => acc + (participant.predictions.includes(result) ? 1 : 0), 0);
                return { name: participant.name, score: score };
            });
            return scores;
        }

        function createScoresCSV(scores, participants) {
            let csvContent = "data:text/csv;charset=utf-8,";
            csvContent += "Name,Score\n"; // Add header

            scores.forEach(score => {
                csvContent += `${score.name},${score.score}\n`;
            });

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "scores.csv");
            document.body.appendChild(link); // Required for Firefox

            link.click(); // This will download the CSV file
        }
    </script>
</body>
</html>

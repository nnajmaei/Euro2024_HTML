<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Participant Results vs. Euro2024 Results</title>
    <style>
        body {
            font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
            margin: 10px;
            background-color: #1e1e1e;
            color: #7c7a7a;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 10px;
            vertical-align: top;
            justify-content: center;
        }
        table, th, td {
            border: 1px solid black;
        }
        th, td {
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #333333;
        }
        select {
            width: 200px;
            background-color: #6b6a6a;
            color: #fff;
            border: 1px solid #444444;
        }
        .comparison-container {
            display: flex;
            justify-content: space-between;
        }
        .table-container {
            width: 45%;
        }
        .logo-container {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }
        .bold-text {
            font-weight: bold;
        }
        .generate-button {
            display: flex;
            justify-content: center;
            margin: 20px;
        }
        button {
            background-color: #fff;
            color: #000;
            padding: 10px 20px;
            margin-top: 10px;
            border: 1px solid #444444;
            cursor: pointer;
            height: 36px;
        }
    </style>
</head>
<body>
    <div class="logo-container">
        <img src="./logos/logo.png" alt="Euro 2024 Logo" style="width:200px;">
    </div>
    <div class="generate-button">
        <button onclick="generateScoresCSV()">Generate Scores CSV</button>
    </div>

    <script>
        const flags = {
            'Germany': 'https://flagcdn.com/w20/de.png',
            'Scotland': 'https://flagcdn.com/w20/gb-sct.png',
            'Hungary': 'https://flagcdn.com/w20/hu.png',
            'Switzerland': 'https://flagcdn.com/w20/ch.png',
            'Spain': 'https://flagcdn.com/w20/es.png',
            'Croatia': 'https://flagcdn.com/w20/hr.png',
            'Italy': 'https://flagcdn.com/w20/it.png',
            'Albania': 'https://flagcdn.com/w20/al.png',
            'Serbia': 'https://flagcdn.com/w20/rs.png',
            'England': 'https://flagcdn.com/w20/gb-eng.png',
            'Slovenia': 'https://flagcdn.com/w20/si.png',
            'Denmark': 'https://flagcdn.com/w20/dk.png',
            'Poland': 'https://flagcdn.com/w20/pl.png',
            'Netherlands': 'https://flagcdn.com/w20/nl.png',
            'Austria': 'https://flagcdn.com/w20/at.png',
            'France': 'https://flagcdn.com/w20/fr.png',
            'Romania': 'https://flagcdn.com/w20/ro.png',
            'Ukraine': 'https://flagcdn.com/w20/ua.png',
            'Belgium': 'https://flagcdn.com/w20/be.png',
            'Slovakia': 'https://flagcdn.com/w20/sk.png',
            'Turkey': 'https://flagcdn.com/w20/tr.png',
            'Georgia': 'https://flagcdn.com/w20/ge.png',
            'Portugal': 'https://flagcdn.com/w20/pt.png',
            'Czechia': 'https://flagcdn.com/w20/cz.png'
        };

        function loadCSV(file, callback) {
            fetch(file)
                .then(response => response.text())
                .then(data => {
                    const rows = data.split('\n').map(row => row.split(','));
                    callback(rows);
                })
                .catch(error => console.error('Error loading CSV:', error));
        }

        function populateDropdowns(participants) {
            const participantSelect = document.getElementById('participantSelect');
            participants.forEach(participant => {
                const option = document.createElement('option');
                option.value = participant.file;
                option.text = participant.name;
                participantSelect.add(option);
            });
        }

        function displayTable(containerId, rows) {
            const boldText = [
                'Group Stage Predictions', 'Group A', 'Group B', 'Group C', 'Group D', 'Group E', 'Group F', 
                'Knockout Stage Predictions', 'Round of 16', 'Quarterfinals', 'Semifinals', 'Final', 
                'Top Goalscorer', 'Best Goalkeeper', 'Player of Tournament'
            ];

            let tableHTML = '<table>';
            rows.forEach(row => {
                tableHTML += '<tr>';
                row.forEach(cell => {
                    const cellContent = cell.trim();
                    const flagImg = flags[cellContent] ? `<img src="${flags[cellContent]}" class="flag"> ` : '';
                    const cellClass = boldText.includes(cellContent) ? 'bold-text' : '';
                    tableHTML += `<td class="${cellClass}">${flagImg}${cellContent}</td>`;
                });
                tableHTML += '</tr>';
            });
            tableHTML += '</table>';
            document.getElementById(containerId).innerHTML = tableHTML;
        }

        function loadParticipantPredictions() {
            const participantSelect = document.getElementById('participantSelect');
            const selectedFile = participantSelect.value;
            if (selectedFile) {
                loadCSV(selectedFile, rows => displayTable('participantPredictions', rows));
            } else {
                document.getElementById('participantPredictions').innerHTML = '';
            }
        }

        function calculateScores(actualResults, participants) {
            const scores = [];
            const promises = participants.map(participant => {
                return new Promise((resolve) => {
                    loadCSV(participant.file, (rows) => {
                        actualResults.forEach((actualResult) => {
                            const [date, team1, team1Score, team2, team2Score] = actualResult;
                            if (team1Score !== undefined && team2Score !== undefined) {
                                const row = [date, team1, team2, team1Score, team2Score];
                                let score = 0;
                                rows.forEach((predRow) => {
                                    if (predRow.includes(team1) && predRow.includes(team2)) {
                                        const team1Index = predRow.indexOf(team1);
                                        const team2Index = predRow.indexOf(team2);
                                        const predictedScore1 = parseInt(predRow[team1Index + 1]);
                                        const predictedScore2 = parseInt(predRow[team2Index + 1]);
                                        const actualScore1 = parseInt(team1Score);
                                        const actualScore2 = parseInt(team2Score);

                                        if (predictedScore1 === actualScore1 && predictedScore2 === actualScore2) {
                                            score = 10;
                                        } else if ((actualScore1 - actualScore2 === predictedScore1 - predictedScore2) && (actualScore1 > actualScore2 && predictedScore1 > predictedScore2 || actualScore1 < actualScore2 && predictedScore1 < predictedScore2)) {
                                            score = 8;
                                        } else if (actualScore1 === actualScore2 && predictedScore1 === predictedScore2) {
                                            score = 5;
                                        } else if ((actualScore1 > actualScore2 && predictedScore1 > predictedScore2) || (actualScore1 < actualScore2 && predictedScore1 < predictedScore2)) {
                                            score = 5;
                                        }
                                    }
                                });
                                row.push(score);
                                scores.push(row);
                            }
                        });
                        resolve();
                    });
                });
            });

            return Promise.all(promises).then(() => scores);
        }

        function createScoresCSV(scores, participants) {
            let csvContent = "data:text/csv;charset=utf-8,Date,Team1,Team2,Actual Score1,Actual Score2";
            participants.forEach(participant => {
                csvContent += `,${participant.name}`;
            });
            csvContent += "\n";

            scores.forEach(row => {
                csvContent += row.join(",") + "\n";
            });

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "scores.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function generateScoresCSV() {
            loadCSV('./results_csv/Actual_Results.csv', actualResults => {
                fetch('./jsons/participants.json')
                    .then(response => response.json())
                    .then(data => {
                        calculateScores(actualResults, data.participants).then(scores => {
                            createScoresCSV(scores, data.participants);
                        });
                    })
                    .catch(error => console.error('Error loading participants list:', error));
            });
        }

        // Load actual results and participant data on page load
        window.onload = function() {
            loadCSV('./results_csv/Actual_Results.csv', actualResults => {
                displayTable('actualResults', actualResults);

                fetch('./jsons/participants.json')
                    .then(response => response.json())
                    .then(data => {
                        populateDropdowns(data.participants);
                    })
                    .catch(error => console.error('Error loading participants list:', error));
            });
        };
    </script>
</body>
</html>
